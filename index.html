<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Ä°htisas GÄ±da | B2B</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <meta name="theme-color" content="#DC2626">
  <style>
    html, body { height: 100%; }
    body { -webkit-tap-highlight-color: transparent; }
    .safe-bottom { padding-bottom: calc(env(safe-area-inset-bottom) + 84px); }
    .tabbar { padding-bottom: env(safe-area-inset-bottom); }
    .line-clamp-2{
      display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical; overflow:hidden;
    }
  </style>
</head>

<body class="bg-gray-100 text-gray-900">
  <!-- Top App Bar -->
  <header class="sticky top-0 z-30 bg-white/95 backdrop-blur border-b">
    <div class="px-4 pt-4 pb-3">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-2">
          <div class="h-10 w-10 rounded-2xl bg-red-600 grid place-items-center text-white font-bold">Ä°G</div>
          <div class="leading-tight">
            <div class="font-semibold">Ä°htisas GÄ±da</div>
            <div class="text-xs text-gray-500">B2B Toptan</div>
          </div>
        </div>

        <button id="searchOpen" class="h-10 px-3 rounded-2xl bg-gray-100 text-sm font-medium">ğŸ” Ara</button>
      </div>

      <!-- Search -->
      <div id="searchWrap" class="mt-3 hidden">
        <div class="flex items-center gap-2 bg-gray-100 rounded-2xl px-3 py-2">
          <span class="text-gray-500">ğŸ”</span>
          <input id="q" class="w-full bg-transparent outline-none text-sm" placeholder="ÃœrÃ¼n ara (Ã¶r: 18L, ayÃ§iÃ§ek, salÃ§a, 25kg)" />
          <button id="clearBtn" class="text-xs text-gray-500 hidden">Temizle</button>
        </div>
      </div>

      <!-- Category chips -->
      <div class="mt-3 -mx-1 flex gap-2 overflow-x-auto pb-1">
        <button class="chip px-4 py-2 rounded-full text-sm font-medium bg-red-600 text-white" data-cat="TÃ¼mÃ¼">TÃ¼mÃ¼</button>
        <button class="chip px-4 py-2 rounded-full text-sm font-medium bg-gray-100" data-cat="YaÄŸlar">YaÄŸlar</button>
        <button class="chip px-4 py-2 rounded-full text-sm font-medium bg-gray-100" data-cat="Bakliyat">Bakliyat</button>
        <button class="chip px-4 py-2 rounded-full text-sm font-medium bg-gray-100" data-cat="Soslar">Soslar</button>
        <button class="chip px-4 py-2 rounded-full text-sm font-medium bg-gray-100" data-cat="Temel GÄ±da">Temel GÄ±da</button>
        <button class="chip px-4 py-2 rounded-full text-sm font-medium bg-gray-100" data-cat="Ä°Ã§ecek">Ä°Ã§ecek</button>
        <button class="chip px-4 py-2 rounded-full text-sm font-medium bg-gray-100" data-cat="Temizlik">Temizlik</button>
      </div>
    </div>
  </header>

  <!-- Views -->
  <main class="safe-bottom">
    <!-- HOME -->
    <section id="view-home" class="px-4 pt-4">
      <!-- Banner carousel -->
      <div class="rounded-3xl overflow-hidden shadow bg-white border">
        <div id="banner" class="p-4 bg-red-600 text-white">
          <div class="text-sm opacity-90" id="bannerKicker">HaftanÄ±n FÄ±rsatlarÄ±</div>
          <div class="text-xl font-semibold mt-1" id="bannerTitle">Ev DÄ±ÅŸÄ± TÃ¼ketim ÃœrÃ¼n GamÄ±</div>
          <div class="mt-2 flex flex-wrap gap-2" id="bannerTags">
            <span class="px-3 py-1 rounded-full bg-white/15 text-xs">18 L YaÄŸlar</span>
            <span class="px-3 py-1 rounded-full bg-white/15 text-xs">5 Kg Soslar</span>
            <span class="px-3 py-1 rounded-full bg-white/15 text-xs">25 Kg Bakliyat</span>
          </div>
        </div>
        <div class="flex items-center justify-between px-4 py-3 bg-white">
          <div class="text-xs text-gray-500">Kampanyalar</div>
          <div class="flex gap-2">
            <button id="bannerPrev" class="h-9 w-9 rounded-2xl bg-gray-100 grid place-items-center">â€¹</button>
            <button id="bannerNext" class="h-9 w-9 rounded-2xl bg-gray-100 grid place-items-center">â€º</button>
          </div>
        </div>
      </div>

      <!-- Meta + sort -->
      <div class="flex items-center justify-between mt-4 mb-3">
        <div>
          <div class="font-semibold">ÃœrÃ¼nler</div>
          <div id="meta" class="text-xs text-gray-500">YÃ¼kleniyorâ€¦</div>
        </div>
        <button id="sortBtn" class="text-sm font-medium px-3 py-2 rounded-2xl bg-white border">SÄ±rala: Ã–nerilen</button>
      </div>

      <div id="grid" class="grid grid-cols-2 gap-3 md:grid-cols-4"></div>
    </section>

    <!-- CATEGORIES (simple) -->
    <section id="view-categories" class="hidden px-4 pt-4">
      <div class="font-semibold text-lg mb-3">Kategoriler</div>
      <div class="grid grid-cols-2 gap-3">
        <button class="catCard bg-white rounded-3xl border shadow-sm p-4 text-left" data-cat="YaÄŸlar">
          <div class="text-sm text-gray-500">Kategori</div>
          <div class="font-semibold text-lg">YaÄŸlar</div>
          <div class="mt-2 text-xs text-gray-500">18 L â€¢ 5 L</div>
        </button>
        <button class="catCard bg-white rounded-3xl border shadow-sm p-4 text-left" data-cat="Bakliyat">
          <div class="text-sm text-gray-500">Kategori</div>
          <div class="font-semibold text-lg">Bakliyat</div>
          <div class="mt-2 text-xs text-gray-500">25 Kg â€¢ 10 Kg</div>
        </button>
        <button class="catCard bg-white rounded-3xl border shadow-sm p-4 text-left" data-cat="Soslar">
          <div class="text-sm text-gray-500">Kategori</div>
          <div class="font-semibold text-lg">Soslar</div>
          <div class="mt-2 text-xs text-gray-500">5 Kg â€¢ 1 Kg</div>
        </button>
        <button class="catCard bg-white rounded-3xl border shadow-sm p-4 text-left" data-cat="Temel GÄ±da">
          <div class="text-sm text-gray-500">Kategori</div>
          <div class="font-semibold text-lg">Temel GÄ±da</div>
          <div class="mt-2 text-xs text-gray-500">Un â€¢ Åeker â€¢ Makarna</div>
        </button>
        <button class="catCard bg-white rounded-3xl border shadow-sm p-4 text-left" data-cat="Ä°Ã§ecek">
          <div class="text-sm text-gray-500">Kategori</div>
          <div class="font-semibold text-lg">Ä°Ã§ecek</div>
          <div class="mt-2 text-xs text-gray-500">Koli â€¢ Pet</div>
        </button>
        <button class="catCard bg-white rounded-3xl border shadow-sm p-4 text-left" data-cat="Temizlik">
          <div class="text-sm text-gray-500">Kategori</div>
          <div class="font-semibold text-lg">Temizlik</div>
          <div class="mt-2 text-xs text-gray-500">4 L â€¢ 5 L</div>
        </button>
      </div>
    </section>

    <!-- CART -->
    <section id="view-cart" class="hidden px-4 pt-4">
      <div class="flex items-center justify-between">
        <div class="font-semibold text-lg">Sepet</div>
        <button id="clearCart" class="text-sm font-medium px-3 py-2 rounded-2xl bg-white border">Sepeti BoÅŸalt</button>
      </div>

      <div id="cartEmpty" class="mt-6 bg-white rounded-3xl border p-5 text-center text-gray-500 hidden">
        Sepetiniz boÅŸ.
      </div>

      <div id="cartList" class="mt-4 space-y-3"></div>

      <div id="cartSummary" class="mt-4 bg-white rounded-3xl border p-4 hidden">
        <div class="flex items-center justify-between text-sm">
          <span class="text-gray-500">Ara Toplam</span>
          <span id="subtotal" class="font-semibold">â‚º0,00</span>
        </div>
        <div class="flex items-center justify-between text-sm mt-2">
          <span class="text-gray-500">Kargo</span>
          <span class="font-semibold">â‚º0,00</span>
        </div>
        <div class="h-px bg-gray-100 my-3"></div>
        <div class="flex items-center justify-between">
          <span class="font-semibold">Genel Toplam</span>
          <span id="total" class="text-xl font-bold text-red-600">â‚º0,00</span>
        </div>

        <button id="goCheckout" class="mt-4 w-full h-12 rounded-2xl bg-red-600 text-white font-semibold">
          Ã–demeye GeÃ§
        </button>
      </div>
    </section>

    <!-- CHECKOUT -->
    <section id="view-checkout" class="hidden px-4 pt-4">
      <div class="flex items-center gap-2">
        <button id="backToCart" class="h-10 w-10 rounded-2xl bg-white border grid place-items-center">â€¹</button>
        <div class="font-semibold text-lg">Ã–deme</div>
      </div>

      <div class="mt-4 bg-white rounded-3xl border p-4">
        <div class="font-semibold mb-2">Teslimat Bilgileri</div>
        <div class="grid gap-2">
          <input class="w-full bg-gray-100 rounded-2xl px-3 py-3 text-sm outline-none" placeholder="Firma ÃœnvanÄ±" value="Ä°htisas GÄ±da MÃ¼ÅŸterisi" />
          <input class="w-full bg-gray-100 rounded-2xl px-3 py-3 text-sm outline-none" placeholder="Telefon" value="+90 5xx xxx xx xx" />
          <input class="w-full bg-gray-100 rounded-2xl px-3 py-3 text-sm outline-none" placeholder="Ä°l / Ä°lÃ§e" value="Ä°stanbul / ..." />
          <textarea class="w-full bg-gray-100 rounded-2xl px-3 py-3 text-sm outline-none" rows="3" placeholder="Adres">...</textarea>
        </div>
      </div>

      <div class="mt-3 bg-white rounded-3xl border p-4">
        <div class="font-semibold mb-2">Ã–deme YÃ¶ntemi</div>
        <div class="grid gap-2 text-sm">
          <label class="flex items-center gap-2 bg-gray-100 rounded-2xl px-3 py-3">
            <input type="radio" name="pay" checked />
            <span>Kart ile Ã–deme</span>
          </label>
          <label class="flex items-center gap-2 bg-gray-100 rounded-2xl px-3 py-3">
            <input type="radio" name="pay" />
            <span>Havale / EFT</span>
          </label>
          <label class="flex items-center gap-2 bg-gray-100 rounded-2xl px-3 py-3">
            <input type="radio" name="pay" />
            <span>KapÄ±da Ã–deme</span>
          </label>
        </div>

        <div class="mt-3 grid gap-2">
          <input class="w-full bg-gray-100 rounded-2xl px-3 py-3 text-sm outline-none" placeholder="Kart NumarasÄ±" value="â€¢â€¢â€¢â€¢ â€¢â€¢â€¢â€¢ â€¢â€¢â€¢â€¢ â€¢â€¢â€¢â€¢" />
          <div class="grid grid-cols-2 gap-2">
            <input class="w-full bg-gray-100 rounded-2xl px-3 py-3 text-sm outline-none" placeholder="SKT" value="MM/YY" />
            <input class="w-full bg-gray-100 rounded-2xl px-3 py-3 text-sm outline-none" placeholder="CVV" value="â€¢â€¢â€¢" />
          </div>
        </div>
      </div>

      <div class="mt-3 bg-white rounded-3xl border p-4">
        <div class="flex items-center justify-between">
          <div class="font-semibold">SipariÅŸ Ã–zeti</div>
          <div id="checkoutCount" class="text-sm text-gray-500">0 Ã¼rÃ¼n</div>
        </div>
        <div class="mt-2 flex items-center justify-between">
          <span class="text-sm text-gray-500">Toplam</span>
          <span id="checkoutTotal" class="text-xl font-bold text-red-600">â‚º0,00</span>
        </div>
        <button id="placeOrder" class="mt-4 w-full h-12 rounded-2xl bg-red-600 text-white font-semibold">
          SipariÅŸi Tamamla
        </button>
      </div>
    </section>

    <!-- ACCOUNT -->
    <section id="view-account" class="hidden px-4 pt-4">
      <div class="font-semibold text-lg mb-3">Hesap</div>
      <div class="bg-white rounded-3xl border p-4">
        <div class="font-semibold">Kurumsal MÃ¼ÅŸteri</div>
        <div class="text-sm text-gray-500 mt-1">Yetkili: ...</div>
        <div class="mt-4 grid gap-2">
          <button class="w-full text-left bg-gray-100 rounded-2xl px-3 py-3 text-sm">ğŸ“¦ SipariÅŸlerim</button>
          <button class="w-full text-left bg-gray-100 rounded-2xl px-3 py-3 text-sm">ğŸ·ï¸ Fiyat Listeleri</button>
          <button class="w-full text-left bg-gray-100 rounded-2xl px-3 py-3 text-sm">ğŸ“ Adresler</button>
          <button class="w-full text-left bg-gray-100 rounded-2xl px-3 py-3 text-sm">âš™ï¸ Ayarlar</button>
        </div>
      </div>
    </section>
  </main>

  <!-- Bottom Nav -->
  <nav class="fixed bottom-0 left-0 right-0 z-40 bg-white border-t tabbar">
    <div class="max-w-md mx-auto px-4 py-2 grid grid-cols-4 text-xs">
      <button class="tab flex flex-col items-center gap-1 py-2 text-red-600 font-semibold" data-view="home">ğŸ <span>Anasayfa</span></button>
      <button class="tab flex flex-col items-center gap-1 py-2 text-gray-500" data-view="categories">ğŸ§¾<span>Kategoriler</span></button>
      <button class="tab flex flex-col items-center gap-1 py-2 text-gray-500 relative" data-view="cart">
        ğŸ›’<span>Sepet</span>
        <span id="cartBadge" class="hidden absolute top-1 right-6 text-[10px] px-2 py-[2px] rounded-full bg-red-600 text-white">0</span>
      </button>
      <button class="tab flex flex-col items-center gap-1 py-2 text-gray-500" data-view="account">ğŸ‘¤<span>Hesap</span></button>
    </div>
  </nav>

  <!-- Product Sheet -->
  <div id="sheetBackdrop" class="fixed inset-0 bg-black/40 hidden z-50"></div>
  <div id="sheet" class="fixed left-0 right-0 bottom-0 z-50 hidden">
    <div class="max-w-md mx-auto bg-white rounded-t-3xl shadow-2xl p-4">
      <div class="flex items-start justify-between gap-3">
        <div>
          <div id="sheetTitle" class="font-semibold text-lg">ÃœrÃ¼n</div>
          <div id="sheetSub" class="text-sm text-gray-500">Paket</div>
        </div>
        <button id="closeSheet" class="h-10 w-10 rounded-2xl bg-gray-100 grid place-items-center">âœ•</button>
      </div>

      <div class="mt-3 h-44 rounded-2xl bg-gray-100 overflow-hidden grid place-items-center">
        <img id="sheetImg" class="h-full w-full object-cover" alt="ÃœrÃ¼n" />
      </div>

      <div class="mt-4 flex items-center justify-between">
        <div>
          <div class="text-xs text-gray-500">Fiyat</div>
          <div id="sheetPrice" class="text-2xl font-bold text-red-600">â‚º0,00</div>
          <div class="text-xs text-gray-500">KDV hariÃ§</div>
        </div>
        <div class="flex items-center gap-2">
          <button id="minus" class="h-11 w-11 rounded-2xl bg-gray-100 text-lg">âˆ’</button>
          <div id="qty" class="min-w-10 text-center font-semibold">1</div>
          <button id="plus" class="h-11 w-11 rounded-2xl bg-gray-100 text-lg">+</button>
        </div>
      </div>

      <button id="addToCart" class="mt-4 w-full h-12 rounded-2xl bg-red-600 text-white font-semibold">
        Sepete Ekle
      </button>
    </div>
  </div>

  <!-- Toast -->
  <div id="toast" class="fixed left-1/2 -translate-x-1/2 bottom-24 z-50 hidden">
    <div class="bg-gray-900 text-white text-sm px-4 py-3 rounded-2xl shadow-lg">Eklendi</div>
  </div>

<script>
  // ---------- Helpers ----------
  function formatTRY(n){
    return "â‚º" + n.toLocaleString("tr-TR", {minimumFractionDigits:2, maximumFractionDigits:2});
  }

  // Simple box placeholder image (SVG data URI)
  function boxImg(text){
    const t = String(text).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");
    const svg =
`<svg xmlns="http://www.w3.org/2000/svg" width="800" height="500">
  <defs>
    <linearGradient id="g" x1="0" y1="0" x2="1" y2="1">
      <stop offset="0" stop-color="#f3f4f6"/>
      <stop offset="1" stop-color="#e5e7eb"/>
    </linearGradient>
  </defs>
  <rect width="100%" height="100%" fill="url(#g)"/>
  <rect x="70" y="80" width="660" height="340" rx="36" fill="#ffffff" stroke="#e5e7eb" stroke-width="6"/>
  <rect x="120" y="140" width="560" height="120" rx="28" fill="#fee2e2"/>
  <text x="400" y="215" text-anchor="middle" font-family="Arial" font-size="44" fill="#b91c1c" font-weight="700">Ä°HTÄ°SAS GIDA</text>
  <text x="400" y="305" text-anchor="middle" font-family="Arial" font-size="34" fill="#111827" font-weight="700">${t}</text>
  <text x="400" y="360" text-anchor="middle" font-family="Arial" font-size="18" fill="#6b7280">Toptan â€¢ Kurumsal â€¢ HÄ±zlÄ±</text>
</svg>`;
    return "data:image/svg+xml;charset=utf-8," + encodeURIComponent(svg);
  }

  // ---------- Product Data (HoReCa / Ev DÄ±ÅŸÄ± TÃ¼ketim odaklÄ±) ----------
  const seed = [
    // YaÄŸlar (18 L / 10 L / 5 L)
    {name:"AyÃ§iÃ§ek YaÄŸÄ±", packs:["18 L Teneke","10 L Teneke","5 L Teneke"], cat:"YaÄŸlar", base:1260},
    {name:"MÄ±sÄ±r YaÄŸÄ±", packs:["18 L Teneke","10 L Teneke","5 L Teneke"], cat:"YaÄŸlar", base:1320},
    {name:"KÄ±zartma YaÄŸÄ±", packs:["18 L Teneke","10 L Teneke"], cat:"YaÄŸlar", base:1380},
    {name:"ZeytinyaÄŸÄ± Riviera", packs:["5 L Teneke","2 L Pet","1 L Pet"], cat:"YaÄŸlar", base:980},

    // Bakliyat (25 kg / 10 kg / 5 kg)
    {name:"PirinÃ§ Baldo", packs:["25 Kg","10 Kg","5 Kg"], cat:"Bakliyat", base:2350},
    {name:"PirinÃ§ OsmancÄ±k", packs:["25 Kg","10 Kg","5 Kg"], cat:"Bakliyat", base:2150},
    {name:"Nohut", packs:["25 Kg","10 Kg","5 Kg"], cat:"Bakliyat", base:2650},
    {name:"Kuru Fasulye", packs:["25 Kg","10 Kg","5 Kg"], cat:"Bakliyat", base:2950},
    {name:"KÄ±rmÄ±zÄ± Mercimek", packs:["25 Kg","10 Kg","5 Kg"], cat:"Bakliyat", base:2450},
    {name:"YeÅŸil Mercimek", packs:["25 Kg","10 Kg","5 Kg"], cat:"Bakliyat", base:2650},

    // Soslar (5 kg / 1 kg / 850 g)
    {name:"Domates SalÃ§a", packs:["5 Kg","1 Kg"], cat:"Soslar", base:520},
    {name:"KetÃ§ap", packs:["5 Kg","1 Kg"], cat:"Soslar", base:490},
    {name:"Mayonez", packs:["5 Kg","1 Kg"], cat:"Soslar", base:540},
    {name:"BBQ Sos", packs:["1 Kg","500 g"], cat:"Soslar", base:180},
    {name:"Pesto Sos", packs:["1 Kg","500 g"], cat:"Soslar", base:260},

    // Temel GÄ±da
    {name:"Un", packs:["25 Kg","10 Kg"], cat:"Temel GÄ±da", base:620},
    {name:"Toz Åeker", packs:["25 Kg","10 Kg","5 Kg"], cat:"Temel GÄ±da", base:980},
    {name:"Makarna", packs:["5 Kg","500 g x 20"], cat:"Temel GÄ±da", base:340},
    {name:"Ã‡ay", packs:["5 Kg","1 Kg"], cat:"Temel GÄ±da", base:890},
    {name:"Tuz", packs:["25 Kg","10 Kg"], cat:"Temel GÄ±da", base:210},

    // Ä°Ã§ecek
    {name:"Su", packs:["1.5 L x 12","0.5 L x 24"], cat:"Ä°Ã§ecek", base:120},
    {name:"GazlÄ± Ä°Ã§ecek", packs:["1 L x 12","330 ml x 24"], cat:"Ä°Ã§ecek", base:340},
    {name:"Meyve Suyu", packs:["1 L x 12"], cat:"Ä°Ã§ecek", base:380},
    {name:"Ayran", packs:["1 L x 12","200 ml x 27"], cat:"Ä°Ã§ecek", base:420},

    // Temizlik
    {name:"BulaÅŸÄ±k DeterjanÄ±", packs:["4 L","20 L Bidon"], cat:"Temizlik", base:210},
    {name:"YÃ¼zey Temizleyici", packs:["4 L","20 L Bidon"], cat:"Temizlik", base:180},
    {name:"Ã‡amaÅŸÄ±r Suyu", packs:["4 L","20 L Bidon"], cat:"Temizlik", base:120},
  ];

  // Generate ~100 products from seed by expanding packs + variants
  const products = [];
  let id = 1;
  const variants = ["Standart", "Ekonomik", "Premium", "Profesyonel"];
  for (const s of seed){
    for (let i=0; i<s.packs.length; i++){
      for (let v=0; v<variants.length; v++){
        const name = (v === 0) ? s.name : `${s.name} ${variants[v]}`;
        const pack = s.packs[i];
        const price = Math.round(s.base * (0.85 + (i*0.05) + (v*0.04)));
        products.push({
          id: id++,
          name,
          pack,
          cat: s.cat,
          price,
          img: boxImg(`${s.name} â€¢ ${pack}`)
        });
      }
    }
  }
  // trim to 100-110 range
  while (products.length > 104) products.pop();

  // ---------- State ----------
  let state = {
    view: "home",
    cat: "TÃ¼mÃ¼",
    q: "",
    sort: "recommended", // priceAsc | priceDesc | nameAsc
    cart: new Map(), // id -> qty
  };

  // ---------- Elements ----------
  const grid = document.getElementById("grid");
  const meta = document.getElementById("meta");
  const qInput = document.getElementById("q");
  const clearBtn = document.getElementById("clearBtn");
  const sortBtn = document.getElementById("sortBtn");
  const cartBadge = document.getElementById("cartBadge");

  const views = {
    home: document.getElementById("view-home"),
    categories: document.getElementById("view-categories"),
    cart: document.getElementById("view-cart"),
    checkout: document.getElementById("view-checkout"),
    account: document.getElementById("view-account"),
  };

  // Sheet
  const sheetBackdrop = document.getElementById("sheetBackdrop");
  const sheet = document.getElementById("sheet");
  const closeSheet = document.getElementById("closeSheet");
  const sheetTitle = document.getElementById("sheetTitle");
  const sheetSub = document.getElementById("sheetSub");
  const sheetPrice = document.getElementById("sheetPrice");
  const sheetImg = document.getElementById("sheetImg");
  const qtyEl = document.getElementById("qty");
  let sheetQty = 1;
  let current = null;

  // Toast
  const toast = document.getElementById("toast");
  let toastTimer = null;
  function showToast(text){
    toast.querySelector("div").textContent = text;
    toast.classList.remove("hidden");
    clearTimeout(toastTimer);
    toastTimer = setTimeout(()=>toast.classList.add("hidden"), 1200);
  }

  // Banner
  const banners = [
    {k:"HaftanÄ±n FÄ±rsatlarÄ±", t:"Ev DÄ±ÅŸÄ± TÃ¼ketim ÃœrÃ¼n GamÄ±", tags:["18 L YaÄŸlar","5 Kg Soslar","25 Kg Bakliyat"]},
    {k:"Toplu AlÄ±m", t:"Koli & Teneke AvantajlarÄ±", tags:["Koli Ä°Ã§ecek","20 L Bidon","25 Kg Ã‡uval"]},
    {k:"HÄ±zlÄ± Teslimat", t:"BÃ¶lgesel Sevkiyat PlanÄ±", tags:["Kurumsal","Toptan","SÃ¼reÃ§ Takibi"]},
  ];
  let bannerIdx = 0;
  const bannerK = document.getElementById("bannerKicker");
  const bannerT = document.getElementById("bannerTitle");
  const bannerTags = document.getElementById("bannerTags");
  function renderBanner(){
    const b = banners[bannerIdx];
    bannerK.textContent = b.k;
    bannerT.textContent = b.t;
    bannerTags.innerHTML = b.tags.map(x=>`<span class="px-3 py-1 rounded-full bg-white/15 text-xs">${x}</span>`).join("");
  }
  document.getElementById("bannerPrev").addEventListener("click", ()=>{
    bannerIdx = (bannerIdx - 1 + banners.length) % banners.length;
    renderBanner();
  });
  document.getElementById("bannerNext").addEventListener("click", ()=>{
    bannerIdx = (bannerIdx + 1) % banners.length;
    renderBanner();
  });

  // ---------- Filtering / Sorting ----------
  function filtered(){
    let list = [...products];

    if(state.cat !== "TÃ¼mÃ¼"){
      list = list.filter(x => x.cat === state.cat);
    }
    if(state.q.trim()){
      const t = state.q.trim().toLowerCase();
      list = list.filter(x =>
        (x.name + " " + x.pack + " " + x.cat).toLowerCase().includes(t)
      );
    }

    if(state.sort === "priceAsc") list.sort((a,b)=>a.price-b.price);
    if(state.sort === "priceDesc") list.sort((a,b)=>b.price-a.price);
    if(state.sort === "nameAsc") list.sort((a,b)=>a.name.localeCompare(b.name, "tr"));

    return list;
  }

  function renderGrid(){
    const list = filtered();
    meta.textContent = `${list.length} Ã¼rÃ¼n â€¢ ${state.cat}${state.q ? " â€¢ " + state.q : ""}`;

    grid.innerHTML = list.map(p => `
      <button class="group bg-white rounded-3xl border shadow-sm active:scale-[0.99] transition p-3 text-left"
              onclick="openSheet(${p.id})">
        <div class="h-24 rounded-2xl bg-gray-100 overflow-hidden">
          <img src="${p.img}" alt="${p.name}" class="h-full w-full object-cover"/>
        </div>
        <div class="mt-2 text-sm font-semibold leading-snug line-clamp-2">${p.name}</div>
        <div class="text-xs text-gray-500">${p.pack}</div>
        <div class="mt-2 flex items-end justify-between gap-2">
          <div class="text-red-600 font-bold">${formatTRY(p.price)}</div>
          <span class="text-[10px] px-2 py-1 rounded-full bg-gray-100 text-gray-600">${p.cat}</span>
        </div>
      </button>
    `).join("");
  }

  // ---------- Navigation ----------
  function setView(v){
    state.view = v;
    Object.keys(views).forEach(k => views[k].classList.toggle("hidden", k !== v));
    document.querySelectorAll(".tab").forEach(t=>{
      const active = t.dataset.view === v || (v==="checkout" && t.dataset.view==="cart");
      t.classList.toggle("text-red-600", active);
      t.classList.toggle("font-semibold", active);
      t.classList.toggle("text-gray-500", !active);
    });

    // Render view-specific
    if(v === "home"){ renderGrid(); }
    if(v === "cart"){ renderCart(); }
    if(v === "checkout"){ renderCheckout(); }
    window.scrollTo({top:0, behavior:"instant"});
  }

  document.querySelectorAll(".tab").forEach(t=>{
    t.addEventListener("click", ()=> setView(t.dataset.view));
  });

  // Category cards
  document.querySelectorAll(".catCard").forEach(btn=>{
    btn.addEventListener("click", ()=>{
      const c = btn.dataset.cat;
      // select chip visually
      state.cat = c;
      document.querySelectorAll(".chip").forEach(b=>{
        b.classList.remove("bg-red-600","text-white");
        b.classList.add("bg-gray-100");
        if(b.dataset.cat === c){
          b.classList.add("bg-red-600","text-white");
          b.classList.remove("bg-gray-100");
        }
      });
      setView("home");
      renderGrid();
    });
  });

  // Chips
  document.querySelectorAll(".chip").forEach(btn=>{
    btn.addEventListener("click", ()=>{
      state.cat = btn.dataset.cat;
      document.querySelectorAll(".chip").forEach(b=>{
        b.classList.remove("bg-red-600","text-white");
        b.classList.add("bg-gray-100");
      });
      btn.classList.add("bg-red-600","text-white");
      btn.classList.remove("bg-gray-100");
      renderGrid();
    });
  });

  // Search open/clear
  const searchWrap = document.getElementById("searchWrap");
  document.getElementById("searchOpen").addEventListener("click", ()=>{
    searchWrap.classList.toggle("hidden");
    if(!searchWrap.classList.contains("hidden")) qInput.focus();
  });

  qInput.addEventListener("input", (e)=>{
    state.q = e.target.value;
    clearBtn.classList.toggle("hidden", !state.q);
    if(state.view !== "home") setView("home");
    renderGrid();
  });
  clearBtn.addEventListener("click", ()=>{
    state.q = "";
    qInput.value = "";
    clearBtn.classList.add("hidden");
    renderGrid();
  });

  // Sort
  const sortModes = [
    {key:"recommended", label:"Ã–nerilen"},
    {key:"priceAsc", label:"Fiyat â†‘"},
    {key:"priceDesc", label:"Fiyat â†“"},
    {key:"nameAsc", label:"Ä°sim Aâ€“Z"},
  ];
  sortBtn.addEventListener("click", ()=>{
    const idx = sortModes.findIndex(x=>x.key===state.sort);
    const next = sortModes[(idx+1) % sortModes.length];
    state.sort = next.key;
    sortBtn.textContent = "SÄ±rala: " + next.label;
    renderGrid();
  });

  // ---------- Product Sheet ----------
  window.openSheet = function(id){
    current = products.find(x=>x.id===id);
    sheetQty = 1;
    qtyEl.textContent = sheetQty;
    sheetTitle.textContent = current.name;
    sheetSub.textContent = `${current.pack} â€¢ ${current.cat}`;
    sheetPrice.textContent = formatTRY(current.price);
    sheetImg.src = current.img;

    sheetBackdrop.classList.remove("hidden");
    sheet.classList.remove("hidden");
  }

  function closeSheetFn(){
    sheetBackdrop.classList.add("hidden");
    sheet.classList.add("hidden");
  }
  closeSheet.addEventListener("click", closeSheetFn);
  sheetBackdrop.addEventListener("click", closeSheetFn);

  document.getElementById("minus").addEventListener("click", ()=>{
    sheetQty = Math.max(1, sheetQty-1);
    qtyEl.textContent = sheetQty;
  });
  document.getElementById("plus").addEventListener("click", ()=>{
    sheetQty = sheetQty+1;
    qtyEl.textContent = sheetQty;
  });

  // ---------- Cart ----------
  function cartCount(){
    let c = 0;
    for(const q of state.cart.values()) c += q;
    return c;
  }
  function setBadge(){
    const c = cartCount();
    cartBadge.textContent = c;
    cartBadge.classList.toggle("hidden", c === 0);
  }
  function addToCart(id, qty){
    const prev = state.cart.get(id) || 0;
    state.cart.set(id, prev + qty);
    setBadge();
  }
  function removeFromCart(id){
    state.cart.delete(id);
    setBadge();
  }
  function setCartQty(id, qty){
    if(qty <= 0) return removeFromCart(id);
    state.cart.set(id, qty);
    setBadge();
  }
  function subtotal(){
    let sum = 0;
    for(const [id, qty] of state.cart.entries()){
      const p = products.find(x=>x.id===id);
      sum += (p.price * qty);
    }
    return sum;
  }

  document.getElementById("addToCart").addEventListener("click", ()=>{
    addToCart(current.id, sheetQty);
    closeSheetFn();
    showToast("Sepete eklendi");
  });

  // Cart render
  const cartEmpty = document.getElementById("cartEmpty");
  const cartList = document.getElementById("cartList");
  const cartSummary = document.getElementById("cartSummary");
  const subtotalEl = document.getElementById("subtotal");
  const totalEl = document.getElementById("total");

  function renderCart(){
    const items = [...state.cart.entries()].map(([id, qty])=>{
      const p = products.find(x=>x.id===id);
      return {p, qty};
    });

    cartEmpty.classList.toggle("hidden", items.length !== 0);
    cartSummary.classList.toggle("hidden", items.length === 0);

    cartList.innerHTML = items.map(({p, qty})=>`
      <div class="bg-white rounded-3xl border p-3 flex gap-3">
        <div class="h-20 w-20 rounded-2xl bg-gray-100 overflow-hidden shrink-0">
          <img src="${p.img}" class="h-full w-full object-cover" alt="${p.name}"/>
        </div>
        <div class="flex-1">
          <div class="font-semibold text-sm line-clamp-2">${p.name}</div>
          <div class="text-xs text-gray-500">${p.pack}</div>
          <div class="mt-2 flex items-center justify-between">
            <div class="text-red-600 font-bold">${formatTRY(p.price)}</div>
            <div class="flex items-center gap-2">
              <button class="h-9 w-9 rounded-2xl bg-gray-100" onclick="cartDec(${p.id})">âˆ’</button>
              <div class="min-w-6 text-center font-semibold">${qty}</div>
              <button class="h-9 w-9 rounded-2xl bg-gray-100" onclick="cartInc(${p.id})">+</button>
              <button class="h-9 px-3 rounded-2xl bg-gray-100 text-sm" onclick="cartDel(${p.id})">Sil</button>
            </div>
          </div>
        </div>
      </div>
    `).join("");

    const s = subtotal();
    subtotalEl.textContent = formatTRY(s);
    totalEl.textContent = formatTRY(s);
  }

  window.cartInc = (id)=>{ setCartQty(id, (state.cart.get(id)||0)+1); renderCart(); };
  window.cartDec = (id)=>{ setCartQty(id, (state.cart.get(id)||0)-1); renderCart(); };
  window.cartDel = (id)=>{ removeFromCart(id); renderCart(); };

  document.getElementById("clearCart").addEventListener("click", ()=>{
    state.cart.clear();
    setBadge();
    renderCart();
  });

  // Checkout
  document.getElementById("goCheckout").addEventListener("click", ()=> setView("checkout"));
  document.getElementById("backToCart").addEventListener("click",
