<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Ä°htisas GÄ±da | B2B</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <meta name="theme-color" content="#DC2626">
  <style>
    html, body { height: 100%; }
    body { -webkit-tap-highlight-color: transparent; }
    .no-scrollbar::-webkit-scrollbar { display:none; }
    .no-scrollbar { -ms-overflow-style:none; scrollbar-width:none; }
    .line-clamp-2{
      display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical; overflow:hidden;
    }
  </style>
</head>

<body class="bg-gray-100 text-gray-900">
  <!-- Top App Bar -->
  <header class="sticky top-0 z-40 bg-white/95 backdrop-blur border-b">
    <div class="px-4 pt-4 pb-3">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-2">
          <div class="h-9 w-9 rounded-xl bg-red-600 grid place-items-center text-white font-bold">Ä°G</div>
          <div class="leading-tight">
            <div class="font-semibold">Ä°htisas GÄ±da</div>
            <div class="text-xs text-gray-500">B2B Toptan Market</div>
          </div>
        </div>
        <button id="openCartTop" class="h-10 px-3 rounded-xl bg-gray-100 text-sm font-medium">
          ğŸ›’ <span id="cartCountTop" class="tabular-nums">0</span>
        </button>
      </div>

      <!-- Search -->
      <div class="mt-3">
        <div class="flex items-center gap-2 bg-gray-100 rounded-2xl px-3 py-2">
          <span class="text-gray-500">ğŸ”</span>
          <input id="q" class="w-full bg-transparent outline-none text-sm" placeholder="ÃœrÃ¼n ara (Ã¶r: 18L, salÃ§a, koli, deterjan)" />
          <button id="clearBtn" class="text-xs text-gray-500 hidden">Temizle</button>
        </div>
      </div>

      <!-- Category chips -->
      <div class="mt-3 -mx-1 flex gap-2 overflow-x-auto pb-1 no-scrollbar">
        <button class="chip px-4 py-2 rounded-full text-sm font-medium bg-red-600 text-white" data-cat="TÃ¼mÃ¼">TÃ¼mÃ¼</button>
        <button class="chip px-4 py-2 rounded-full text-sm font-medium bg-gray-100" data-cat="YaÄŸlar">YaÄŸlar</button>
        <button class="chip px-4 py-2 rounded-full text-sm font-medium bg-gray-100" data-cat="Bakliyat">Bakliyat</button>
        <button class="chip px-4 py-2 rounded-full text-sm font-medium bg-gray-100" data-cat="Soslar">Soslar</button>
        <button class="chip px-4 py-2 rounded-full text-sm font-medium bg-gray-100" data-cat="Temel GÄ±da">Temel GÄ±da</button>
        <button class="chip px-4 py-2 rounded-full text-sm font-medium bg-gray-100" data-cat="Ä°Ã§ecek">Ä°Ã§ecek</button>
        <button class="chip px-4 py-2 rounded-full text-sm font-medium bg-gray-100" data-cat="Temizlik">Temizlik</button>
      </div>
    </div>
  </header>

  <!-- Banners / Sliders (simple) -->
  <section class="px-4 pt-4">
    <div class="grid gap-3">
      <div class="rounded-2xl bg-red-600 text-white p-4 shadow">
        <div class="text-sm opacity-90">Ev DÄ±ÅŸÄ± TÃ¼ketim</div>
        <div class="text-lg font-semibold">18 L yaÄŸlar â€¢ Koli Ã¼rÃ¼nler â€¢ Toptan avantaj</div>
        <div class="mt-2 flex gap-2 flex-wrap">
          <span class="px-3 py-1 rounded-full bg-white/15 text-xs">HORECA</span>
          <span class="px-3 py-1 rounded-full bg-white/15 text-xs">Toplu alÄ±m</span>
          <span class="px-3 py-1 rounded-full bg-white/15 text-xs">HÄ±zlÄ± sevkiyat</span>
        </div>
      </div>

      <div class="rounded-2xl bg-white border shadow-sm p-4 flex items-center justify-between">
        <div>
          <div class="text-sm text-gray-500">Ã–ne Ã‡Ä±kanlar</div>
          <div class="font-semibold">YaÄŸ â€¢ SalÃ§a â€¢ Åeker â€¢ Un</div>
        </div>
        <button id="gotoFeatured" class="px-3 py-2 rounded-xl bg-gray-100 text-sm font-medium">GÃ¶rÃ¼ntÃ¼le</button>
      </div>
    </div>
  </section>

  <!-- Products -->
  <main class="px-4 pt-4 pb-28">
    <div class="flex items-center justify-between mb-3">
      <div>
        <div class="font-semibold">ÃœrÃ¼nler</div>
        <div id="meta" class="text-xs text-gray-500">YÃ¼kleniyorâ€¦</div>
      </div>
      <button id="sortBtn" class="text-sm font-medium px-3 py-2 rounded-xl bg-white border">SÄ±rala: Ã–nerilen</button>
    </div>

    <div id="grid" class="grid grid-cols-2 gap-3 md:grid-cols-4"></div>
  </main>

  <!-- Bottom Nav -->
  <nav class="fixed bottom-0 left-0 right-0 z-40 bg-white border-t">
    <div class="max-w-md mx-auto px-4 py-2 grid grid-cols-4 text-xs">
      <button class="tab flex flex-col items-center gap-1 py-2 text-red-600 font-semibold" data-tab="home">ğŸ <span>Anasayfa</span></button>
      <button class="tab flex flex-col items-center gap-1 py-2 text-gray-500" data-tab="categories">ğŸ§¾<span>Kategoriler</span></button>
      <button id="openCartTab" class="tab flex flex-col items-center gap-1 py-2 text-gray-500" data-tab="cart">ğŸ›’<span>Sepet</span></button>
      <button class="tab flex flex-col items-center gap-1 py-2 text-gray-500" data-tab="account">ğŸ‘¤<span>Hesap</span></button>
    </div>
  </nav>

  <!-- Backdrop -->
  <div id="backdrop" class="fixed inset-0 bg-black/40 hidden z-50"></div>

  <!-- Product Sheet -->
  <div id="sheet" class="fixed left-0 right-0 bottom-0 z-50 hidden">
    <div class="max-w-md mx-auto bg-white rounded-t-3xl shadow-2xl p-4">
      <div class="flex items-start justify-between gap-3">
        <div>
          <div id="sheetTitle" class="font-semibold text-lg">ÃœrÃ¼n</div>
          <div id="sheetSub" class="text-sm text-gray-500">Paket</div>
        </div>
        <button id="closeSheet" class="h-10 w-10 rounded-xl bg-gray-100 grid place-items-center">âœ•</button>
      </div>

      <div class="mt-3 h-40 rounded-2xl bg-gray-100 grid place-items-center">
        <!-- Box placeholder -->
        <svg viewBox="0 0 140 90" class="h-24 w-40">
          <path d="M18 30 L70 10 L122 30 L70 50 Z" fill="#e5e7eb"/>
          <path d="M18 30 L70 50 L70 84 L18 64 Z" fill="#d1d5db"/>
          <path d="M122 30 L70 50 L70 84 L122 64 Z" fill="#cbd5e1"/>
          <path d="M18 30 L70 50 L122 30" stroke="#9ca3af" stroke-width="2" fill="none"/>
          <text x="70" y="58" text-anchor="middle" font-size="10" fill="#6b7280">Ä°htisas GÄ±da</text>
        </svg>
      </div>

      <div class="mt-4 flex items-center justify-between">
        <div>
          <div class="text-xs text-gray-500">Toptan Fiyat</div>
          <div id="sheetPrice" class="text-xl font-semibold text-red-600">â‚º0,00</div>
          <div class="text-xs text-gray-500">KDV hariÃ§</div>
        </div>
        <div class="flex items-center gap-2">
          <button id="minus" class="h-11 w-11 rounded-xl bg-gray-100 text-lg">âˆ’</button>
          <div id="qty" class="min-w-10 text-center font-semibold">1</div>
          <button id="plus" class="h-11 w-11 rounded-xl bg-gray-100 text-lg">+</button>
        </div>
      </div>

      <button id="addToCart" class="mt-4 w-full h-12 rounded-2xl bg-red-600 text-white font-semibold">
        Sepete Ekle
      </button>

      <div class="mt-3 text-[11px] text-gray-500">
        Sevkiyat ve fiyatlar firma anlaÅŸmalarÄ±na gÃ¶re deÄŸiÅŸebilir.
      </div>
    </div>
  </div>

  <!-- Cart Sheet -->
  <div id="cartSheet" class="fixed left-0 right-0 bottom-0 z-50 hidden">
    <div class="max-w-md mx-auto bg-white rounded-t-3xl shadow-2xl p-4">
      <div class="flex items-start justify-between gap-3">
        <div>
          <div class="font-semibold text-lg">Sepet</div>
          <div id="cartMeta" class="text-sm text-gray-500">0 Ã¼rÃ¼n</div>
        </div>
        <button id="closeCart" class="h-10 w-10 rounded-xl bg-gray-100 grid place-items-center">âœ•</button>
      </div>

      <div id="cartList" class="mt-3 max-h-[45vh] overflow-auto pr-1"></div>

      <div class="mt-3 rounded-2xl bg-gray-50 p-3 border">
        <div class="flex items-center justify-between text-sm">
          <span class="text-gray-600">Ara Toplam</span>
          <span id="subTotal" class="font-semibold">â‚º0,00</span>
        </div>
        <div class="flex items-center justify-between text-sm mt-1">
          <span class="text-gray-600">Kargo</span>
          <span id="shipping" class="font-semibold">â‚º0,00</span>
        </div>
        <div class="flex items-center justify-between text-base mt-2">
          <span class="font-semibold">Toplam</span>
          <span id="grandTotal" class="font-bold text-red-600">â‚º0,00</span>
        </div>
      </div>

      <button id="goCheckout" class="mt-3 w-full h-12 rounded-2xl bg-red-600 text-white font-semibold disabled:opacity-40" disabled>
        Ã–demeye GeÃ§
      </button>
      <button id="clearCart" class="mt-2 w-full h-11 rounded-2xl bg-white border font-semibold">
        Sepeti Temizle
      </button>
    </div>
  </div>

  <!-- Checkout Screen -->
  <div id="checkout" class="fixed inset-0 z-50 hidden bg-gray-100">
    <header class="sticky top-0 bg-white border-b">
      <div class="px-4 py-4 flex items-center justify-between">
        <div class="flex items-center gap-2">
          <button id="backFromCheckout" class="h-10 w-10 rounded-xl bg-gray-100 grid place-items-center">â†</button>
          <div>
            <div class="font-semibold">Ã–deme</div>
            <div class="text-xs text-gray-500">Teslimat ve Ã¶deme bilgileri</div>
          </div>
        </div>
        <div class="text-sm font-semibold text-red-600" id="checkoutTotal">â‚º0,00</div>
      </div>
    </header>

    <main class="px-4 py-4 pb-28 max-w-md mx-auto">
      <div class="rounded-2xl bg-white border shadow-sm p-4">
        <div class="font-semibold">Teslimat Bilgileri</div>
        <div class="mt-3 grid gap-2">
          <input class="h-11 rounded-xl border px-3 outline-none" placeholder="Firma ÃœnvanÄ±" />
          <input class="h-11 rounded-xl border px-3 outline-none" placeholder="Yetkili KiÅŸi" />
          <input class="h-11 rounded-xl border px-3 outline-none" placeholder="Telefon" />
          <input class="h-11 rounded-xl border px-3 outline-none" placeholder="Adres" />
          <div class="grid grid-cols-2 gap-2">
            <input class="h-11 rounded-xl border px-3 outline-none" placeholder="Ä°l" />
            <input class="h-11 rounded-xl border px-3 outline-none" placeholder="Ä°lÃ§e" />
          </div>
        </div>
      </div>

      <div class="rounded-2xl bg-white border shadow-sm p-4 mt-3">
        <div class="font-semibold">Ã–deme Bilgileri</div>
        <div class="mt-3 grid gap-2">
          <input class="h-11 rounded-xl border px-3 outline-none" placeholder="Kart Ãœzerindeki Ä°sim" />
          <input class="h-11 rounded-xl border px-3 outline-none" placeholder="Kart NumarasÄ±" />
          <div class="grid grid-cols-3 gap-2">
            <input class="h-11 rounded-xl border px-3 outline-none" placeholder="AA" />
            <input class="h-11 rounded-xl border px-3 outline-none" placeholder="YY" />
            <input class="h-11 rounded-xl border px-3 outline-none" placeholder="CVC" />
          </div>
        </div>
      </div>

      <div class="rounded-2xl bg-white border shadow-sm p-4 mt-3">
        <div class="flex items-center justify-between">
          <div class="font-semibold">SipariÅŸ Ã–zeti</div>
          <button id="viewCartFromCheckout" class="text-sm font-semibold text-red-600">Sepeti GÃ¶r</button>
        </div>
        <div class="mt-2 text-sm text-gray-600">
          <div class="flex justify-between"><span>Ara Toplam</span><span id="sumSub">â‚º0,00</span></div>
          <div class="flex justify-between mt-1"><span>Kargo</span><span id="sumShip">â‚º0,00</span></div>
          <div class="flex justify-between mt-2 text-base font-semibold"><span>Toplam</span><span id="sumTotal" class="text-red-600">â‚º0,00</span></div>
        </div>
      </div>
    </main>

    <nav class="fixed bottom-0 left-0 right-0 bg-white border-t">
      <div class="max-w-md mx-auto p-3">
        <button id="placeOrder" class="w-full h-12 rounded-2xl bg-red-600 text-white font-semibold">
          SipariÅŸi Onayla
        </button>
        <div class="mt-2 text-[11px] text-gray-500 text-center">
          Ã–deme ve sipariÅŸ akÄ±ÅŸÄ± firma sÃ¼reÃ§lerine gÃ¶re deÄŸiÅŸebilir.
        </div>
      </div>
    </nav>
  </div>

<script>
  // ---------- Helpers ----------
  const $ = (id) => document.getElementById(id);
  function formatTRY(n){
    return "â‚º" + n.toLocaleString("tr-TR", {minimumFractionDigits:2, maximumFractionDigits:2});
  }
  function openOverlay(which){
    $("backdrop").classList.remove("hidden");
    which.classList.remove("hidden");
  }
  function closeOverlay(which){
    which.classList.add("hidden");
    $("backdrop").classList.add("hidden");
  }

  // ---------- Data (HORECA / ev dÄ±ÅŸÄ± tÃ¼ketim odaklÄ±) ----------
  const base = [
    {name:"AyÃ§iÃ§ek YaÄŸÄ±", pack:"18 L Teneke", cat:"YaÄŸlar", price:1650},
    {name:"MÄ±sÄ±r YaÄŸÄ±", pack:"18 L Teneke", cat:"YaÄŸlar", price:1725},
    {name:"ZeytinyaÄŸÄ± Riviera", pack:"5 L Teneke", cat:"YaÄŸlar", price:980},
    {name:"SÄ±vÄ± YaÄŸ", pack:"5 L Pet", cat:"YaÄŸlar", price:355},
    {name:"PirinÃ§ OsmancÄ±k", pack:"25 Kg Ã‡uval", cat:"Bakliyat", price:2350},
    {name:"PirinÃ§ Baldo", pack:"5 Kg", cat:"Bakliyat", price:325},
    {name:"KÄ±rmÄ±zÄ± Mercimek", pack:"10 Kg", cat:"Bakliyat", price:625},
    {name:"Nohut", pack:"10 Kg", cat:"Bakliyat", price:780},
    {name:"Kuru Fasulye", pack:"10 Kg", cat:"Bakliyat", price:920},
    {name:"Domates SalÃ§a", pack:"5 Kg", cat:"Soslar", price:295},
    {name:"Biber SalÃ§a", pack:"5 Kg", cat:"Soslar", price:315},
    {name:"KetÃ§ap", pack:"5 Kg", cat:"Soslar", price:240},
    {name:"Mayonez", pack:"5 Kg", cat:"Soslar", price:265},
    {name:"Soya Sos", pack:"1 L", cat:"Soslar", price:120},
    {name:"Toz Åeker", pack:"50 Kg Ã‡uval", cat:"Temel GÄ±da", price:3450},
    {name:"Un", pack:"25 Kg Ã‡uval", cat:"Temel GÄ±da", price:720},
    {name:"Makarna", pack:"500 g x 20 Koli", cat:"Temel GÄ±da", price:290},
    {name:"Ã‡ay", pack:"5 Kg", cat:"Temel GÄ±da", price:850},
    {name:"GazlÄ± Ä°Ã§ecek", pack:"1 L x 12 Koli", cat:"Ä°Ã§ecek", price:210},
    {name:"Meyve Suyu", pack:"1 L x 12 Koli", cat:"Ä°Ã§ecek", price:275},
    {name:"Su", pack:"1.5 L x 6", cat:"Ä°Ã§ecek", price:58},
    {name:"BulaÅŸÄ±k DeterjanÄ±", pack:"20 L Bidon", cat:"Temizlik", price:980},
    {name:"YÃ¼zey Temizleyici", pack:"20 L Bidon", cat:"Temizlik", price:720},
    {name:"Ã‡amaÅŸÄ±r Suyu", pack:"20 L Bidon", cat:"Temizlik", price:410},
  ];

  // 100'e yakÄ±n Ã¼rÃ¼n hissi iÃ§in varyasyon Ã¼ret
  const altPacks = [
    "18 L Teneke","5 L Teneke","5 L Pet",
    "25 Kg Ã‡uval","10 Kg","5 Kg",
    "500 g x 20 Koli","1 L x 12 Koli","20 L Bidon"
  ];

  const products = [];
  let id = 1;
  for (let r=0; r<6; r++){
    for (const p of base){
      const pack = altPacks[(r + p.name.length) % altPacks.length];
      const factor = 0.92 + (r*0.03);
      const price = Math.max(12, Math.round(p.price * factor));
      const tag = (p.cat === "YaÄŸlar" && pack.includes("18")) ? "HORECA" :
                  (pack.includes("Koli") || pack.includes("Ã‡uval")) ? "Koli" : "";
      products.push({ id:id++, name:p.name, pack, cat:p.cat, price, tag });
      if (products.length >= 100) break;
    }
    if (products.length >= 100) break;
  }

  // ---------- State ----------
  let state = { cat:"TÃ¼mÃ¼", q:"", sort:"recommended" };
  let current = null;
  let qty = 1;

  // Cart: {productId: quantity}
  const cart = new Map();

  // ---------- UI refs ----------
  const grid = $("grid");
  const meta = $("meta");
  const qInput = $("q");
  const clearBtn = $("clearBtn");
  const sortBtn = $("sortBtn");

  // ---------- Filtering / sorting ----------
  function filtered(){
    let list = [...products];
    if(state.cat !== "TÃ¼mÃ¼") list = list.filter(x => x.cat === state.cat);
    if(state.q.trim()){
      const t = state.q.trim().toLowerCase();
      list = list.filter(x => (x.name+" "+x.pack+" "+x.cat).toLowerCase().includes(t));
    }
    if(state.sort === "priceAsc") list.sort((a,b)=>a.price-b.price);
    if(state.sort === "priceDesc") list.sort((a,b)=>b.price-a.price);
    if(state.sort === "nameAsc") list.sort((a,b)=>a.name.localeCompare(b.name, "tr"));
    return list;
  }

  function boxSVG(label){
    const safe = (label || "ÃœrÃ¼n").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");
    return `
      <svg viewBox="0 0 140 90" class="h-16 w-full">
        <path d="M18 30 L70 10 L122 30 L70 50 Z" fill="#e5e7eb"/>
        <path d="M18 30 L70 50 L70 84 L18 64 Z" fill="#d1d5db"/>
        <path d="M122 30 L70 50 L70 84 L122 64 Z" fill="#cbd5e1"/>
        <path d="M18 30 L70 50 L122 30" stroke="#9ca3af" stroke-width="2" fill="none"/>
        <text x="70" y="58" text-anchor="middle" font-size="10" fill="#6b7280">${safe}</text>
      </svg>
    `;
  }

  // ---------- Render products ----------
  function render(){
    const list = filtered();
    meta.textContent = `${list.length} Ã¼rÃ¼n â€¢ ${state.cat}${state.q ? " â€¢ " + state.q : ""}`;

    grid.innerHTML = list.map(p => `
      <button class="group bg-white rounded-2xl border shadow-sm active:scale-[0.99] transition p-3 text-left"
              onclick="openProduct(${p.id})">
        <div class="h-24 rounded-xl bg-gray-100 grid place-items-center overflow-hidden">
          ${boxSVG("Ä°htisas")}
        </div>
        <div class="mt-2 text-sm font-semibold leading-snug line-clamp-2">${p.name}</div>
        <div class="text-xs text-gray-500">${p.pack}</div>
        <div class="mt-1 flex items-end justify-between gap-2">
          <div class="text-red-600 font-bold">${formatTRY(p.price)}</div>
          <span class="text-[10px] px-2 py-1 rounded-full bg-gray-100 text-gray-600">${p.cat}</span>
        </div>
        ${p.tag ? `<div class="mt-2 text-[10px] inline-flex px-2 py-1 rounded-full bg-red-50 text-red-700 font-semibold">${p.tag}</div>` : ``}
      </button>
    `).join("");
  }

  // ---------- Chips ----------
  document.querySelectorAll(".chip").forEach(btn=>{
    btn.addEventListener("click", ()=>{
      state.cat = btn.dataset.cat;
      document.querySelectorAll(".chip").forEach(b=>{
        b.classList.remove("bg-red-600","text-white");
        b.classList.add("bg-gray-100");
      });
      btn.classList.add("bg-red-600","text-white");
      btn.classList.remove("bg-gray-100");
      render();
    });
  });

  // ---------- Search ----------
  qInput.addEventListener("input", (e)=>{
    state.q = e.target.value;
    clearBtn.classList.toggle("hidden", !state.q);
    render();
  });
  clearBtn.addEventListener("click", ()=>{
    state.q = "";
    qInput.value = "";
    clearBtn.classList.add("hidden");
    render();
  });

  // ---------- Sort ----------
  const sortModes = [
    {key:"recommended", label:"Ã–nerilen"},
    {key:"priceAsc", label:"Fiyat â†‘"},
    {key:"priceDesc", label:"Fiyat â†“"},
    {key:"nameAsc", label:"Ä°sim Aâ€“Z"},
  ];
  sortBtn.addEventListener("click", ()=>{
    const idx = sortModes.findIndex(x=>x.key===state.sort);
    const next = sortModes[(idx+1) % sortModes.length];
    state.sort = next.key;
    sortBtn.textContent = "SÄ±rala: " + next.label;
    render();
  });

  // ---------- Bottom tabs (visual only) ----------
  document.querySelectorAll(".tab").forEach(t=>{
    t.addEventListener("click", ()=>{
      document.querySelectorAll(".tab").forEach(x=>{
        x.classList.remove("text-red-600","font-semibold");
        x.classList.add("text-gray-500");
      });
      t.classList.add("text-red-600","font-semibold");
      t.classList.remove("text-gray-500");
    });
  });

  // ---------- Product sheet ----------
  const sheet = $("sheet");
  const closeSheet = $("closeSheet");
  const sheetTitle = $("sheetTitle");
  const sheetSub = $("sheetSub");
  const sheetPrice = $("sheetPrice");
  const qtyEl = $("qty");

  window.openProduct = function(id){
    current = products.find(x=>x.id===id);
    qty = 1;
    qtyEl.textContent = qty;
    sheetTitle.textContent = current.name;
    sheetSub.textContent = current.pack + " â€¢ " + current.cat;
    sheetPrice.textContent = formatTRY(current.price);
    openOverlay(sheet);
  };

  function closeProduct(){
    closeOverlay(sheet);
  }
  closeSheet.addEventListener("click", closeProduct);
  $("backdrop").addEventListener("click", ()=>{
    // If cart sheet open, don't close product from backdrop (we'll handle with z order)
    if(!sheet.classList.contains("hidden")) closeProduct();
    if(!cartSheet.classList.contains("hidden")) closeCart();
  });

  $("minus").addEventListener("click", ()=>{
    qty = Math.max(1, qty-1);
    qtyEl.textContent = qty;
  });
  $("plus").addEventListener("click", ()=>{
    qty = qty+1;
    qtyEl.textContent = qty;
  });

  $("addToCart").addEventListener("click", ()=>{
    if(!current) return;
    const existing = cart.get(current.id) || 0;
    cart.set(current.id, existing + qty);
    updateCartBadges();
    closeProduct();
    openCart(); // hissiyat iÃ§in direkt sepeti aÃ§
  });

  // ---------- Cart ----------
  const cartSheet = $("cartSheet");
  const cartList = $("cartList");
  const cartMeta = $("cartMeta");
  const subTotal = $("subTotal");
  const shipping = $("shipping");
  const grandTotal = $("grandTotal");
  const checkoutTotal = $("checkoutTotal");
  const sumSub = $("sumSub");
  const sumShip = $("sumShip");
  const sumTotal = $("sumTotal");

  function cartItems(){
    const items = [];
    for(const [pid, q] of cart.entries()){
      const p = products.find(x=>x.id===pid);
      if(p) items.push({ ...p, qty:q });
    }
    return items;
  }

  function calcTotals(){
    const items = cartItems();
    const sub = items.reduce((acc,it)=>acc + it.price*it.qty, 0);
    const ship = sub > 1500 ? 0 : (sub === 0 ? 0 : 149); // basit kural
    const total = sub + ship;
    return { sub, ship, total, count: items.reduce((a,i)=>a+i.qty,0), lines: items.length };
  }

  function updateCartBadges(){
    const {count} = calcTotals();
    $("cartCountTop").textContent = count;
  }

  function renderCart(){
    const items = cartItems();
    const t = calcTotals();

    cartMeta.textContent = `${t.lines} kalem â€¢ ${t.count} adet`;
    subTotal.textContent = formatTRY(t.sub);
    shipping.textContent = formatTRY(t.ship);
    grandTotal.textContent = formatTRY(t.total);

    // enable checkout
    $("goCheckout").disabled = (t.count === 0);

    if(items.length === 0){
      cartList.innerHTML = `
        <div class="py-10 text-center text-gray-500">
          Sepetiniz boÅŸ.
        </div>
      `;
      return;
    }

    cartList.innerHTML = items.map(it => `
      <div class="flex gap-3 items-start bg-white border rounded-2xl p-3 mb-2">
        <div class="h-14 w-16 rounded-xl bg-gray-100 grid place-items-center overflow-hidden">
          ${boxSVG("Ä°htisas")}
        </div>
        <div class="flex-1">
          <div class="text-sm font-semibold leading-snug">${it.name}</div>
          <div class="text-xs text-gray-500">${it.pack} â€¢ ${it.cat}</div>
          <div class="mt-1 flex items-center justify-between">
            <div class="text-sm font-bold text-red-600">${formatTRY(it.price)}</div>
            <div class="flex items-center gap-2">
              <button class="h-9 w-9 rounded-xl bg-gray-100" onclick="cartDec(${it.id})">âˆ’</button>
              <div class="min-w-6 text-center font-semibold tabular-nums">${it.qty}</div>
              <button class="h-9 w-9 rounded-xl bg-gray-100" onclick="cartInc(${it.id})">+</button>
            </div>
          </div>
        </div>
      </div>
    `).join("");
  }

  function openCart(){
    renderCart();
    openOverlay(cartSheet);
  }
  function closeCart(){
    closeOverlay(cartSheet);
  }

  $("openCartTop").addEventListener("click", openCart);
  $("openCartTab").addEventListener("click", openCart);
  $("closeCart").addEventListener("click", closeCart);

  window.cartInc = function(pid){
    cart.set(pid, (cart.get(pid)||0) + 1);
    updateCartBadges();
    renderCart();
  }
  window.cartDec = function(pid){
    const cur = cart.get(pid)||0;
    if(cur <= 1) cart.delete(pid);
    else cart.set(pid, cur-1);
    updateCartBadges();
    renderCart();
  }

  $("clearCart").addEventListener("click", ()=>{
    cart.clear();
    updateCartBadges();
    renderCart();
  });

  // Featured shortcut: jump to YaÄŸlar & 18L query
  $("gotoFeatured").addEventListener("click", ()=>{
    state.cat = "YaÄŸlar";
    document.querySelectorAll(".chip").forEach(b=>{
      b.classList.remove("bg-red-600","text-white");
      b.classList.add("bg-gray-100");
    });
    const oilChip = [...document.querySelectorAll(".chip")].find(x=>x.dataset.cat==="YaÄŸlar");
    if(oilChip){
      oilChip.classList.add("bg-red-600","text-white");
      oilChip.classList.remove("bg-gray-100");
    }
    state.q = "18";
    qInput.value = "18";
    clearBtn.classList.remove("hidden");
    render();
    window.scrollTo({top:0, behavior:"smooth"});
  });

  // ---------- Checkout ----------
  const checkout = $("checkout");

  function syncCheckoutSummary(){
    const t = calcTotals();
    checkoutTotal.textContent = formatTRY(t.total);
    sumSub.textContent = formatTRY(t.sub);
    sumShip.textContent = formatTRY(t.ship);
    sumTotal.textContent = formatTRY(t.total);
  }

  $("goCheckout").addEventListener("click", ()=>{
    closeCart();
    syncCheckoutSummary();
    checkout.classList.remove("hidden");
    // backdrop kapalÄ± kalsÄ±n, checkout tam ekran
    $("backdrop").classList.add("hidden");
  });

  $("backFromCheckout").addEventListener("click", ()=>{
    checkout.classList.add("hidden");
    openCart();
  });

  $("viewCartFromCheckout").addEventListener("click", ()=>{
    checkout.classList.add("hidden");
    openCart();
  });

  $("placeOrder").addEventListener("click", ()=>{
    // SipariÅŸ verildi hissi
    const t = calcTotals();
    if(t.count === 0){
      alert("Sepet boÅŸ.");
      return;
    }
    alert("SipariÅŸiniz alÄ±nmÄ±ÅŸtÄ±r. TeÅŸekkÃ¼rler.");
    cart.clear();
    updateCartBadges();
    checkout.classList.add("hidden");
  });

  // ---------- Init ----------
  updateCartBadges();
  render();
</script>
</body>
</html>
