<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Ä°htisas GÄ±da | B2B</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <meta name="theme-color" content="#D8222E" />
  <style>
    :root{
      --brand:#D8222E;   /* ana kÄ±rmÄ±zÄ± */
      --accent:#F5C400;  /* vurgu sarÄ± */
      --ink:#111827;
      --muted:#6B7280;
      --bg:#F3F4F6;
    }
    html,body{height:100%;}
    body{-webkit-tap-highlight-color: transparent;background:var(--bg);color:var(--ink);}
    .no-scrollbar::-webkit-scrollbar{display:none;}
    .no-scrollbar{-ms-overflow-style:none;scrollbar-width:none;}
    .brand-bg{background:var(--brand)!important;}
    .brand-text{color:var(--brand)!important;}
    .accent-bg{background:var(--accent)!important;}
    .card{background:#fff;border:1px solid rgba(17,24,39,.08);border-radius:16px;box-shadow:0 1px 0 rgba(0,0,0,.04);}
    .tap:active{transform:scale(.99);}
    .line-clamp-2{
      display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;
    }
    .safe-bottom{padding-bottom: env(safe-area-inset-bottom);}
  </style>
</head>

<body class="pb-24">

  <!-- TOP: Logo -->
  <header class="sticky top-0 z-40 bg-white/95 backdrop-blur border-b">
    <div class="px-4 pt-4 pb-3">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-2">
          <div class="h-10 w-10 rounded-2xl brand-bg grid place-items-center text-white font-extrabold">Ä°G</div>
          <div class="leading-tight">
            <div class="font-semibold text-base">Ä°htisas GÄ±da</div>
            <div class="text-xs text-gray-500">B2B Toptan Market</div>
          </div>
        </div>

        <button id="openCartTop"
                class="relative h-10 px-3 rounded-2xl bg-gray-100 text-sm font-semibold tap">
          ğŸ›’ <span id="cartCountTop" class="tabular-nums">0</span>
          <span id="cartDot" class="hidden absolute -top-1 -right-1 h-3 w-3 rounded-full accent-bg"></span>
        </button>
      </div>

      <!-- Search -->
      <div class="mt-3">
        <div class="flex items-center gap-2 bg-gray-100 rounded-2xl px-3 py-2">
          <span class="text-gray-500">ğŸ”</span>
          <input id="q" class="w-full bg-transparent outline-none text-sm"
                 placeholder="ÃœrÃ¼n, kategori veya paket ara" />
          <button id="clearBtn" class="text-xs text-gray-500 hidden">Temizle</button>
        </div>
      </div>

      <!-- Toast -->
      <div id="toast"
           class="hidden mt-3 rounded-2xl brand-bg text-white px-4 py-3 text-sm font-semibold">
        ÃœrÃ¼n alÄ±ÅŸveriÅŸ sepetinize eklendi
      </div>
    </div>
  </header>

  <!-- Banner -->
  <section class="px-4 pt-4">
    <div class="rounded-2xl brand-bg text-white p-4 shadow">
      <div class="text-xs opacity-90">Ev DÄ±ÅŸÄ± TÃ¼ketim</div>
      <div class="text-lg font-extrabold leading-snug mt-1">
        18 L YaÄŸ â€¢ Koli ÃœrÃ¼n â€¢ Toptan SatÄ±ÅŸ
      </div>
      <div class="mt-2 flex gap-2 flex-wrap">
        <span class="px-3 py-1 rounded-full bg-white/15 text-xs font-semibold">HORECA</span>
        <span class="px-3 py-1 rounded-full bg-white/15 text-xs font-semibold">Toplu AlÄ±m</span>
        <span class="px-3 py-1 rounded-full bg-white/15 text-xs font-semibold">HÄ±zlÄ± Sevkiyat</span>
      </div>
    </div>
  </section>

  <!-- Categories -->
  <section class="px-4 pt-4">
    <div class="flex items-center justify-between">
      <div class="font-semibold">Kategoriler</div>
      <button id="openCategories" class="text-sm font-semibold brand-text">TÃ¼mÃ¼</button>
    </div>

    <div class="mt-3 -mx-1 flex gap-2 overflow-x-auto no-scrollbar pb-1">
      <button class="chip px-4 py-2 rounded-full text-sm font-semibold brand-bg text-white tap" data-cat="TÃ¼mÃ¼">TÃ¼mÃ¼</button>
      <button class="chip px-4 py-2 rounded-full text-sm font-semibold bg-white border tap" data-cat="YaÄŸlar">YaÄŸlar</button>
      <button class="chip px-4 py-2 rounded-full text-sm font-semibold bg-white border tap" data-cat="Bakliyat">Bakliyat</button>
      <button class="chip px-4 py-2 rounded-full text-sm font-semibold bg-white border tap" data-cat="Soslar">Soslar</button>
      <button class="chip px-4 py-2 rounded-full text-sm font-semibold bg-white border tap" data-cat="Temel GÄ±da">Temel GÄ±da</button>
      <button class="chip px-4 py-2 rounded-full text-sm font-semibold bg-white border tap" data-cat="Ä°Ã§ecek">Ä°Ã§ecek</button>
      <button class="chip px-4 py-2 rounded-full text-sm font-semibold bg-white border tap" data-cat="Temizlik">Temizlik</button>
    </div>
  </section>

  <!-- Best Sellers -->
  <section class="px-4 pt-4">
    <div class="flex items-center justify-between">
      <div class="font-semibold">Ã‡ok Satanlar</div>
      <button id="gotoAllProducts" class="text-sm font-semibold brand-text">TÃ¼m Ã¼rÃ¼nler</button>
    </div>

    <div id="bestRow" class="mt-3 flex gap-3 overflow-x-auto no-scrollbar pb-1"></div>
  </section>

  <!-- Products -->
  <main class="px-4 pt-4 pb-28" id="productsSection">
    <div class="flex items-center justify-between mb-3">
      <div>
        <div class="font-semibold">ÃœrÃ¼nler</div>
        <div id="meta" class="text-xs text-gray-500">YÃ¼kleniyorâ€¦</div>
      </div>
      <button id="sortBtn" class="text-sm font-semibold px-3 py-2 rounded-2xl bg-white border tap">
        SÄ±rala: Ã–nerilen
      </button>
    </div>

    <div id="grid" class="grid grid-cols-2 gap-3 md:grid-cols-4"></div>
  </main>

  <!-- Bottom Nav -->
  <nav class="fixed bottom-0 left-0 right-0 z-40 bg-white border-t safe-bottom">
    <div class="max-w-md mx-auto px-4 py-2 grid grid-cols-4 text-xs">
      <button class="tab flex flex-col items-center gap-1 py-2 brand-text font-extrabold tap" data-tab="home">ğŸ <span>Anasayfa</span></button>
      <button id="tabCategories" class="tab flex flex-col items-center gap-1 py-2 text-gray-500 font-semibold tap" data-tab="categories">ğŸ§¾<span>Kategori</span></button>
      <button id="openCartTab" class="tab flex flex-col items-center gap-1 py-2 text-gray-500 font-semibold tap relative" data-tab="cart">
        ğŸ›’<span>Sepet</span>
        <span id="cartDotTab" class="hidden absolute top-1 right-6 h-2.5 w-2.5 rounded-full accent-bg"></span>
      </button>
      <button class="tab flex flex-col items-center gap-1 py-2 text-gray-500 font-semibold tap" data-tab="profile">ğŸ‘¤<span>Profil</span></button>
    </div>
  </nav>

  <!-- Backdrop -->
  <div id="backdrop" class="fixed inset-0 bg-black/40 hidden z-50"></div>

  <!-- Product Sheet -->
  <div id="sheet" class="fixed left-0 right-0 bottom-0 z-50 hidden">
    <div class="max-w-md mx-auto bg-white rounded-t-3xl shadow-2xl p-4">
      <div class="flex items-start justify-between gap-3">
        <div>
          <div id="sheetTitle" class="font-extrabold text-lg">ÃœrÃ¼n</div>
          <div id="sheetSub" class="text-sm text-gray-500">Paket</div>
        </div>
        <button id="closeSheet" class="h-10 w-10 rounded-2xl bg-gray-100 grid place-items-center tap">âœ•</button>
      </div>

      <div class="mt-3 h-40 rounded-2xl bg-gray-100 grid place-items-center overflow-hidden">
        <div id="sheetBox" class="w-full px-4"></div>
      </div>

      <div class="mt-4 flex items-center justify-between">
        <div>
          <div class="text-xs text-gray-500">Toptan Fiyat</div>
          <div id="sheetPrice" class="text-2xl font-extrabold brand-text">â‚º0,00</div>
          <div class="text-xs text-gray-500">KDV hariÃ§</div>
        </div>

        <div class="flex items-center gap-2">
          <button id="minus" class="h-11 w-11 rounded-2xl bg-gray-100 text-lg font-extrabold tap">âˆ’</button>
          <div id="qty" class="min-w-10 text-center font-extrabold tabular-nums">1</div>
          <button id="plus" class="h-11 w-11 rounded-2xl bg-gray-100 text-lg font-extrabold tap">+</button>
        </div>
      </div>

      <button id="addToCart" class="mt-4 w-full h-12 rounded-2xl brand-bg text-white font-extrabold tap">
        Sepete Ekle
      </button>

      <div class="mt-3 text-[11px] text-gray-500">
        Sevkiyat ve fiyatlar firma anlaÅŸmalarÄ±na gÃ¶re deÄŸiÅŸebilir.
      </div>
    </div>
  </div>

  <!-- Cart Sheet -->
  <div id="cartSheet" class="fixed left-0 right-0 bottom-0 z-50 hidden">
    <div class="max-w-md mx-auto bg-white rounded-t-3xl shadow-2xl p-4">
      <div class="flex items-start justify-between gap-3">
        <div>
          <div class="font-extrabold text-lg">AlÄ±ÅŸveriÅŸ Sepeti</div>
          <div id="cartMeta" class="text-sm text-gray-500">0 Ã¼rÃ¼n</div>
        </div>
        <button id="closeCart" class="h-10 w-10 rounded-2xl bg-gray-100 grid place-items-center tap">âœ•</button>
      </div>

      <div id="cartList" class="mt-3 max-h-[45vh] overflow-auto pr-1"></div>

      <div class="mt-3 rounded-2xl bg-gray-50 p-3 border">
        <div class="flex items-center justify-between text-sm">
          <span class="text-gray-600">Ara Toplam</span>
          <span id="subTotal" class="font-extrabold">â‚º0,00</span>
        </div>
        <div class="flex items-center justify-between text-sm mt-1">
          <span class="text-gray-600">Kargo</span>
          <span id="shipping" class="font-extrabold">â‚º0,00</span>
        </div>
        <div class="flex items-center justify-between text-base mt-2">
          <span class="font-extrabold">Toplam</span>
          <span id="grandTotal" class="font-extrabold brand-text">â‚º0,00</span>
        </div>
      </div>

      <button id="goCheckout" class="mt-3 w-full h-12 rounded-2xl brand-bg text-white font-extrabold tap disabled:opacity-40" disabled>
        Ã–demeye GeÃ§
      </button>
      <button id="clearCart" class="mt-2 w-full h-11 rounded-2xl bg-white border font-extrabold tap">
        Sepeti Temizle
      </button>
    </div>
  </div>

  <!-- Checkout Screen -->
  <div id="checkout" class="fixed inset-0 z-50 hidden bg-gray-100">
    <header class="sticky top-0 bg-white border-b">
      <div class="px-4 py-4 flex items-center justify-between">
        <div class="flex items-center gap-2">
          <button id="backFromCheckout" class="h-10 w-10 rounded-2xl bg-gray-100 grid place-items-center tap">â†</button>
          <div>
            <div class="font-extrabold">Ã–deme</div>
            <div class="text-xs text-gray-500">Teslimat ve Ã¶deme bilgileri</div>
          </div>
        </div>
        <div class="text-sm font-extrabold brand-text" id="checkoutTotal">â‚º0,00</div>
      </div>
    </header>

    <main class="px-4 py-4 pb-28 max-w-md mx-auto">
      <div class="card p-4">
        <div class="font-extrabold">Teslimat Bilgileri</div>
        <div class="mt-3 grid gap-2">
          <input class="h-11 rounded-2xl border px-3 outline-none" placeholder="Firma ÃœnvanÄ±" />
          <input class="h-11 rounded-2xl border px-3 outline-none" placeholder="Yetkili KiÅŸi" />
          <input class="h-11 rounded-2xl border px-3 outline-none" placeholder="Telefon" />
          <input class="h-11 rounded-2xl border px-3 outline-none" placeholder="Adres" />
          <div class="grid grid-cols-2 gap-2">
            <input class="h-11 rounded-2xl border px-3 outline-none" placeholder="Ä°l" />
            <input class="h-11 rounded-2xl border px-3 outline-none" placeholder="Ä°lÃ§e" />
          </div>
        </div>
      </div>

      <div class="card p-4 mt-3">
        <div class="font-extrabold">Ã–deme Bilgileri</div>
        <div class="mt-3 grid gap-2">
          <input class="h-11 rounded-2xl border px-3 outline-none" placeholder="Kart Ãœzerindeki Ä°sim" />
          <input class="h-11 rounded-2xl border px-3 outline-none" placeholder="Kart NumarasÄ±" />
          <div class="grid grid-cols-3 gap-2">
            <input class="h-11 rounded-2xl border px-3 outline-none" placeholder="AA" />
            <input class="h-11 rounded-2xl border px-3 outline-none" placeholder="YY" />
            <input class="h-11 rounded-2xl border px-3 outline-none" placeholder="CVC" />
          </div>
        </div>
      </div>

      <div class="card p-4 mt-3">
        <div class="flex items-center justify-between">
          <div class="font-extrabold">SipariÅŸ Ã–zeti</div>
          <button id="viewCartFromCheckout" class="text-sm font-extrabold brand-text tap">Sepeti GÃ¶r</button>
        </div>
        <div class="mt-2 text-sm text-gray-600">
          <div class="flex justify-between"><span>Ara Toplam</span><span id="sumSub">â‚º0,00</span></div>
          <div class="flex justify-between mt-1"><span>Kargo</span><span id="sumShip">â‚º0,00</span></div>
          <div class="flex justify-between mt-2 text-base font-extrabold"><span>Toplam</span><span id="sumTotal" class="brand-text">â‚º0,00</span></div>
        </div>
      </div>
    </main>

    <nav class="fixed bottom-0 left-0 right-0 bg-white border-t safe-bottom">
      <div class="max-w-md mx-auto p-3">
        <button id="placeOrder" class="w-full h-12 rounded-2xl brand-bg text-white font-extrabold tap">
          SipariÅŸi Onayla
        </button>
        <div class="mt-2 text-[11px] text-gray-500 text-center">
          Ã–deme ve sipariÅŸ akÄ±ÅŸÄ± firma sÃ¼reÃ§lerine gÃ¶re deÄŸiÅŸebilir.
        </div>
      </div>
    </nav>
  </div>

<script>
  // ---------- helpers ----------
  const $ = (id)=>document.getElementById(id);
  function formatTRY(n){
    return "â‚º" + n.toLocaleString("tr-TR",{minimumFractionDigits:2,maximumFractionDigits:2});
  }
  function showToast(){
    const t = $("toast");
    if(!t) return;
    t.classList.remove("hidden");
    clearTimeout(window.__toastTimer);
    window.__toastTimer = setTimeout(()=>t.classList.add("hidden"), 1200);
  }
  function openOverlay(el){
    $("backdrop").classList.remove("hidden");
    el.classList.remove("hidden");
  }
  function closeOverlay(el){
    el.classList.add("hidden");
    $("backdrop").classList.add("hidden");
  }
  function boxSVG(label){
    const safe = (label||"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");
    return `
      <svg viewBox="0 0 220 120" class="h-20 w-full">
        <defs>
          <linearGradient id="g1" x1="0" x2="1">
            <stop offset="0" stop-color="#e5e7eb"/>
            <stop offset="1" stop-color="#f3f4f6"/>
          </linearGradient>
        </defs>
        <path d="M30 40 L110 12 L190 40 L110 68 Z" fill="url(#g1)"/>
        <path d="M30 40 L110 68 L110 110 L30 82 Z" fill="#d1d5db"/>
        <path d="M190 40 L110 68 L110 110 L190 82 Z" fill="#cbd5e1"/>
        <path d="M30 40 L110 68 L190 40" stroke="#9ca3af" stroke-width="2" fill="none"/>
        <text x="110" y="84" text-anchor="middle" font-size="12" fill="#6b7280" font-weight="700">${safe}</text>
      </svg>
    `;
  }

  // ---------- data (HORECA / ev dÄ±ÅŸÄ± tÃ¼ketim odaklÄ±) ----------
  const base = [
    {name:"AyÃ§iÃ§ek YaÄŸÄ±", pack:"18 L Teneke", cat:"YaÄŸlar", price:1650},
    {name:"MÄ±sÄ±r YaÄŸÄ±", pack:"18 L Teneke", cat:"YaÄŸlar", price:1725},
    {name:"SÄ±vÄ± YaÄŸ", pack:"5 L Pet", cat:"YaÄŸlar", price:355},
    {name:"ZeytinyaÄŸÄ± Riviera", pack:"5 L Teneke", cat:"YaÄŸlar", price:980},

    {name:"PirinÃ§ OsmancÄ±k", pack:"25 Kg Ã‡uval", cat:"Bakliyat", price:2350},
    {name:"PirinÃ§ Baldo", pack:"5 Kg", cat:"Bakliyat", price:325},
    {name:"KÄ±rmÄ±zÄ± Mercimek", pack:"10 Kg", cat:"Bakliyat", price:625},
    {name:"Nohut", pack:"10 Kg", cat:"Bakliyat", price:780},
    {name:"Kuru Fasulye", pack:"10 Kg", cat:"Bakliyat", price:920},

    {name:"Domates SalÃ§a", pack:"5 Kg", cat:"Soslar", price:295},
    {name:"Biber SalÃ§a", pack:"5 Kg", cat:"Soslar", price:315},
    {name:"KetÃ§ap", pack:"5 Kg", cat:"Soslar", price:240},
    {name:"Mayonez", pack:"5 Kg", cat:"Soslar", price:265},
    {name:"Soya Sos", pack:"1 L", cat:"Soslar", price:120},

    {name:"Toz Åeker", pack:"50 Kg Ã‡uval", cat:"Temel GÄ±da", price:3450},
    {name:"Un", pack:"25 Kg Ã‡uval", cat:"Temel GÄ±da", price:720},
    {name:"Makarna", pack:"500 g x 20 Koli", cat:"Temel GÄ±da", price:290},
    {name:"Ã‡ay", pack:"5 Kg", cat:"Temel GÄ±da", price:850},

    {name:"GazlÄ± Ä°Ã§ecek", pack:"1 L x 12 Koli", cat:"Ä°Ã§ecek", price:210},
    {name:"Meyve Suyu", pack:"1 L x 12 Koli", cat:"Ä°Ã§ecek", price:275},
    {name:"Su", pack:"1.5 L x 6", cat:"Ä°Ã§ecek", price:58},

    {name:"BulaÅŸÄ±k DeterjanÄ±", pack:"20 L Bidon", cat:"Temizlik", price:980},
    {name:"YÃ¼zey Temizleyici", pack:"20 L Bidon", cat:"Temizlik", price:720},
    {name:"Ã‡amaÅŸÄ±r Suyu", pack:"20 L Bidon", cat:"Temizlik", price:410}
  ];

  const altPacks = [
    "18 L Teneke","10 L Teneke","5 L Teneke","5 L Pet",
    "25 Kg Ã‡uval","10 Kg","5 Kg","2.5 Kg",
    "500 g x 20 Koli","1 L x 12 Koli","330 ml x 24 Koli",
    "20 L Bidon","10 L Bidon","5 L Bidon"
  ];

  // 100'e yakÄ±n Ã¼rÃ¼n hissi
  const products = [];
  let id = 1;
  for(let r=0; r<7; r++){
    for(const p of base){
      const pack = altPacks[(r + p.name.length) % altPacks.length];
      const factor = 0.90 + (r*0.03);
      const price = Math.max(12, Math.round(p.price * factor));
      const tag =
        (p.cat==="YaÄŸlar" && pack.includes("18")) ? "HORECA" :
        (pack.includes("Koli") || pack.includes("Ã‡uval")) ? "Koli" :
        (pack.includes("Bidon")) ? "EndÃ¼striyel" : "";
      products.push({id:id++, name:p.name, pack, cat:p.cat, price, tag});
      if(products.length>=100) break;
    }
    if(products.length>=100) break;
  }

  // Best sellers (sabit seÃ§elim)
  const bestIds = products
    .filter(p=>["YaÄŸlar","Bakliyat","Soslar"].includes(p.cat))
    .slice(0, 10)
    .map(p=>p.id);

  // ---------- state ----------
  let state = {cat:"TÃ¼mÃ¼", q:"", sort:"recommended"};
  let current = null;
  let qty = 1;

  // cart: Map(productId -> quantity)
  const cart = new Map();

  // ---------- UI refs ----------
  const grid = $("grid");
  const meta = $("meta");
  const bestRow = $("bestRow");
  const qInput = $("q");
  const clearBtn = $("clearBtn");
  const sortBtn = $("sortBtn");

  // ---------- filtering/sorting ----------
  function filtered(){
    let list = [...products];

    if(state.cat !== "TÃ¼mÃ¼"){
      list = list.filter(x=>x.cat===state.cat);
    }
    if(state.q.trim()){
      const t = state.q.trim().toLowerCase();
      list = list.filter(x => (x.name+" "+x.pack+" "+x.cat+" "+x.tag).toLowerCase().includes(t));
    }

    if(state.sort==="priceAsc") list.sort((a,b)=>a.price-b.price);
    if(state.sort==="priceDesc") list.sort((a,b)=>b.price-a.price);
    if(state.sort==="nameAsc") list.sort((a,b)=>a.name.localeCompare(b.name,"tr"));

    return list;
  }

  // ---------- render products ----------
  function render(){
    const list = filtered();
    meta.textContent = `${list.length} Ã¼rÃ¼n â€¢ ${state.cat}${state.q ? " â€¢ " + state.q : ""}`;

    grid.innerHTML = list.map(p=>`
      <button class="tap card p-2 text-left"
              onclick="openProduct(${p.id})">
        <div class="h-24 rounded-xl bg-gray-100 grid place-items-center overflow-hidden">
          ${boxSVG("")}
        </div>
        <div class="mt-2 text-sm font-extrabold leading-snug line-clamp-2">${p.name}</div>
        <div class="text-xs text-gray-500 font-semibold">${p.pack}</div>

        <div class="mt-1 flex items-end justify-between gap-2">
          <div class="brand-text font-extrabold">${formatTRY(p.price)}</div>
          <span class="text-[10px] px-2 py-1 rounded-full bg-gray-100 text-gray-700 font-extrabold">${p.cat}</span>
        </div>

        ${p.tag ? `<div class="mt-2 text-[10px] inline-flex px-2 py-1 rounded-full bg-yellow-50 text-yellow-800 font-extrabold">${p.tag}</div>` : ``}
      </button>
    `).join("");
  }

  // ---------- render best sellers ----------
  function renderBest(){
    const picks = bestIds.map(id=>products.find(p=>p.id===id)).filter(Boolean);
    bestRow.innerHTML = picks.map(p=>`
      <button class="tap card min-w-[190px] p-3 text-left"
              onclick="openProduct(${p.id})">
        <div class="flex items-start justify-between gap-2">
          <div class="text-sm font-extrabold line-clamp-2">${p.name}</div>
          ${p.tag ? `<span class="text-[10px] px-2 py-1 rounded-full bg-yellow-50 text-yellow-800 font-extrabold">${p.tag}</span>` : ``}
        </div>
        <div class="mt-2 h-14 rounded-xl bg-gray-100 grid place-items-center overflow-hidden">
          ${boxSVG("")}
        </div>
        <div class="mt-2 flex items-end justify-between">
          <div class="text-xs text-gray-500 font-semibold">${p.pack}</div>
          <div class="brand-text font-extrabold">${formatTRY(p.price)}</div>
        </div>
      </button>
    `).join("");
  }

  // ---------- chips ----------
  document.querySelectorAll(".chip").forEach(btn=>{
    btn.addEventListener("click", ()=>{
      state.cat = btn.dataset.cat;

      document.querySelectorAll(".chip").forEach(b=>{
        b.classList.remove("brand-bg","text-white");
        b.classList.add("bg-white","border");
      });

      btn.classList.add("brand-bg","text-white");
      btn.classList.remove("bg-white","border");

      render();
      // Ã¼rÃ¼nler bÃ¶lÃ¼mÃ¼ne hafif kaydÄ±r
      if(state.cat !== "TÃ¼mÃ¼"){
        $("productsSection").scrollIntoView({behavior:"smooth", block:"start"});
      }
    });
  });

  // ---------- search ----------
  qInput.addEventListener("input", (e)=>{
    state.q = e.target.value;
    clearBtn.classList.toggle("hidden", !state.q);
    render();
  });
  clearBtn.addEventListener("click", ()=>{
    state.q = "";
    qInput.value = "";
    clearBtn.classList.add("hidden");
    render();
  });

  // ---------- sort ----------
  const sortModes = [
    {key:"recommended", label:"Ã–nerilen"},
    {key:"priceAsc", label:"Fiyat â†‘"},
    {key:"priceDesc", label:"Fiyat â†“"},
    {key:"nameAsc", label:"Ä°sim Aâ€“Z"},
  ];
  sortBtn.addEventListener("click", ()=>{
    const idx = sortModes.findIndex(x=>x.key===state.sort);
    const next = sortModes[(idx+1)%sortModes.length];
    state.sort = next.key;
    sortBtn.textContent = "SÄ±rala: " + next.label;
    render();
  });

  // ---------- tabs (visual) ----------
  document.querySelectorAll(".tab").forEach(t=>{
    t.addEventListener("click", ()=>{
      document.querySelectorAll(".tab").forEach(x=>{
        x.classList.remove("brand-text","font-extrabold");
        x.classList.add("text-gray-500","font-semibold");
      });
      t.classList.add("brand-text","font-extrabold");
      t.classList.remove("text-gray-500","font-semibold");
    });
  });

  // ---------- product sheet ----------
  const sheet = $("sheet");
  const closeSheet = $("closeSheet");
  const sheetTitle = $("sheetTitle");
  const sheetSub = $("sheetSub");
  const sheetPrice = $("sheetPrice");
  const qtyEl = $("qty");
  const sheetBox = $("sheetBox");

  window.openProduct = function(id){
    current = products.find(x=>x.id===id);
    if(!current) return;
    qty = 1;
    qtyEl.textContent = qty;
    sheetTitle.textContent = current.name;
    sheetSub.textContent = current.pack + " â€¢ " + current.cat;
    sheetPrice.textContent = formatTRY(current.price);
    sheetBox.innerHTML = boxSVG("Ä°htisas GÄ±da");
    openOverlay(sheet);
  };

  function closeProduct(){ closeOverlay(sheet); }
  closeSheet.addEventListener("click", closeProduct);

  // backdrop closes whichever overlay is open
  $("backdrop").addEventListener("click", ()=>{
    if(!sheet.classList.contains("hidden")) closeProduct();
    if(!cartSheet.classList.contains("hidden")) closeCart();
  });

  $("minus").addEventListener("click", ()=>{
    qty = Math.max(1, qty-1);
    qtyEl.textContent = qty;
  });
  $("plus").addEventListener("click", ()=>{
    qty++;
    qtyEl.textContent = qty;
  });

  $("addToCart").addEventListener("click", ()=>{
    if(!current) return;
    cart.set(current.id, (cart.get(current.id)||0) + qty);
    updateCartBadges();
    showToast();
    closeProduct();
    openCart();
  });

  // ---------- cart ----------
  const cartSheet = $("cartSheet");
  const cartList = $("cartList");
  const cartMeta = $("cartMeta");
  const subTotal = $("subTotal");
  const shipping = $("shipping");
  const grandTotal = $("grandTotal");

  function cartItems(){
    const items = [];
    for(const [pid, q] of cart.entries()){
      const p = products.find(x=>x.id===pid);
      if(p) items.push({...p, qty:q});
    }
    return items;
  }

  function calcTotals(){
    const items = cartItems();
    const sub = items.reduce((acc,it)=>acc + it.price*it.qty, 0);
    const ship = sub > 1500 ? 0 : (sub===0 ? 0 : 149);
    const total = sub + ship;
    const count = items.reduce((a,i)=>a+i.qty,0);
    return {sub, ship, total, count, lines: items.length};
  }

  function updateCartBadges(){
    const t = calcTotals();
    $("cartCountTop").textContent = t.count;

    const dotTop = $("cartDot");
    const dotTab = $("cartDotTab");
    const btn = $("openCartTop");

    if(t.count > 0){
      btn.classList.add("brand-bg","text-white");
      btn.classList.remove("bg-gray-100");
      dotTop.classList.remove("hidden");
      dotTab.classList.remove("hidden");
    } else {
      btn.classList.remove("brand-bg","text-white");
      btn.classList.add("bg-gray-100");
      dotTop.classList.add("hidden");
      dotTab.classList.add("hidden");
    }
  }

  function renderCart(){
    const items = cartItems();
    const t = calcTotals();
    cartMeta.textContent = `${t.lines} kalem â€¢ ${t.count} adet`;
    subTotal.textContent = formatTRY(t.sub);
    shipping.textContent = formatTRY(t.ship);
    grandTotal.textContent = formatTRY(t.total);
    $("goCheckout").disabled = (t.count === 0);

    if(items.length===0){
      cartList.innerHTML = `<div class="py-10 text-center text-gray-500 font-semibold">Sepetiniz boÅŸ.</div>`;
      return;
    }

    cartList.innerHTML = items.map(it=>`
      <div class="card p-3 mb-2">
        <div class="flex gap-3 items-start">
          <div class="h-14 w-16 rounded-xl bg-gray-100 grid place-items-center overflow-hidden">
            ${boxSVG("")}
          </div>
          <div class="flex-1">
            <div class="text-sm font-extrabold leading-snug">${it.name}</div>
            <div class="text-xs text-gray-500 font-semibold">${it.pack} â€¢ ${it.cat}</div>
            <div class="mt-1 flex items-center justify-between">
              <div class="font-extrabold brand-text">${formatTRY(it.price)}</div>
              <div class="flex items-center gap-2">
                <button class="h-9 w-9 rounded-2xl bg-gray-100 font-extrabold tap" onclick="cartDec(${it.id})">âˆ’</button>
                <div class="min-w-6 text-center font-extrabold tabular-nums">${it.qty}</div>
                <button class="h-9 w-9 rounded-2xl bg-gray-100 font-extrabold tap" onclick="cartInc(${it.id})">+</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    `).join("");
  }

  function openCart(){
    renderCart();
    openOverlay(cartSheet);
  }
  function closeCart(){
    closeOverlay(cartSheet);
  }

  $("openCartTop").addEventListener("click", openCart);
  $("openCartTab").addEventListener("click", openCart);
  $("closeCart").addEventListener("click", closeCart);

  window.cartInc = function(pid){
    cart.set(pid, (cart.get(pid)||0)+1);
    updateCartBadges();
    renderCart();
  };
  window.cartDec = function(pid){
    const cur = cart.get(pid)||0;
    if(cur<=1) cart.delete(pid);
    else cart.set(pid, cur-1);
    updateCartBadges();
    renderCart();
  };

  $("clearCart").addEventListener("click", ()=>{
    cart.clear();
    updateCartBadges();
    renderCart();
  });

  // ---------- checkout ----------
  const checkout = $("checkout");
  const checkoutTotal = $("checkoutTotal");
  const sumSub = $("sumSub");
  const sumShip = $("sumShip");
  const sumTotal = $("sumTotal");

  function syncCheckoutSummary(){
    const t = calcTotals();
    checkoutTotal.textContent = formatTRY(t.total);
    sumSub.textContent = formatTRY(t.sub);
    sumShip.textContent = formatTRY(t.ship);
    sumTotal.textContent = formatTRY(t.total);
  }

  $("goCheckout").addEventListener("click", ()=>{
    closeCart();
    syncCheckoutSummary();
    checkout.classList.remove("hidden");
    $("backdrop").classList.add("hidden");
  });

  $("backFromCheckout").addEventListener("click", ()=>{
    checkout.classList.add("hidden");
    openCart();
  });

  $("viewCartFromCheckout").addEventListener("click", ()=>{
    checkout.classList.add("hidden");
    openCart();
  });

  $("placeOrder").addEventListener("click", ()=>{
    const t = calcTotals();
    if(t.count===0){
      alert("Sepet boÅŸ.");
      return;
    }
    alert("SipariÅŸiniz alÄ±nmÄ±ÅŸtÄ±r. TeÅŸekkÃ¼rler.");
    cart.clear();
    updateCartBadges();
    checkout.classList.add("hidden");
  });

  // ---------- nav shortcuts ----------
  $("gotoAllProducts").addEventListener("click", ()=>{
    $("productsSection").scrollIntoView({behavior:"smooth", block:"start"});
  });
  $("tabCategories").addEventListener("click", ()=>{
    // kategori alanÄ±na kaydÄ±r
    document.querySelector("section.px-4.pt-4").scrollIntoView({behavior:"smooth", block:"start"});
  });

  // init
  updateCartBadges();
  renderBest();
  render();
</script>
</body>
</html>
